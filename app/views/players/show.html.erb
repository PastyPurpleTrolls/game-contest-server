<% setTitle("Player") %>
<br>
<ol class="breadcrumb">
    <li><a href="<%= root_path %>">Home</a></li>
    <li><a href="<%= contests_path %>">Contests</a></li>
    <li><a href="<%= contest_path(@player.contest) %>"><%= @player.contest.name %></a></li>
    <li class="active"><%= @player.name %></li>
</ol>
<div class="row">
    <div class="container center display-container col-md-offset-1 col-md-10">
        <div class="row">
            <div class="col-xs-8 col-xs-offset-2">
                <h1 class="headings left"><%= @player.name %></h1>
            </div>
            <% if current_user == @player.user or @player.deletable?(current_user) %>
                <div class="col-xs-2 right form-dropdown">
                    <div class="dropdown">
                        <a href="#" class="dropdown-toggle btn" data-toggle="dropdown">Options <span class="caret"/></a>
                        <ul class="dropdown-menu">
                            <% if current_user == @player.user %>
                                <%= active_link_to 'Edit', edit_player_path(@player), wrap_tag: :li %>
                            <% end %>
                            <% if @player.deletable?(current_user) %>
                                <%= active_link_to 'Delete', player_path(@player), method: :delete, data: { confirm: 'Are you sure?' }, wrap_tag: :li %>
                            <% end %>
                        </ul>
                    </div>
                </div>
            <% end %>
        </div>
        <div class="row">
            <div class="col-md-12">            
                <p class="info-container">Description: <%= @player.description %></p>
            </div>
            <div class="col-md-6">
                <p class="info-container">Contest: <%= link_to @player.contest.name, @player.contest %></p>
            </div>
            <div class="col-md-6">
                <p class="info-container">Creator: <%= link_to @player.user.username, @player.user %></p>
            </div>
        </div>
        <% if @player.playable %>
            <p>This player can be challenged <%= content_tag('i', nil, class: 'glyphicon glyphicon-ok') %></p>
        <% else %>
            <p>This player cannot be challenged <%= content_tag('i', nil, class: 'glyphicon glyphicon-remove') %></p>                
        <% end %>
        <% if @player.downloadable %>
            <p>This player can be downloaded <%= content_tag('i', nil, class: 'glyphicon glyphicon-ok') %></p><!-- need link here -->
        <% else %>
            <p>This player cannot be downloaded <%= content_tag('i', nil, class: 'glyphicon glyphicon-remove') %></p>                
        <% end %>
    </div>
</div>

<div class="row">
    <div class="container center display-container col-md-offset-3 col-md-6">
        <h1 class="headings left row">Statistics</h1>
        <p class="info-container">Wins: <%= @playermatch.where(result: 'Win').count %></p>
        <p class="info-container">Losses: <%= @playermatch.where(result: 'Loss').count %></p>
        <p class="info-container">Ties: <%= @playermatch.where(result: 'Tie').count %></p>
        <p class="info-container">Win Percentage:
            <%= (@playermatch.where(result: 'Win').count.to_f / @playermatch.count * 100).round(2) %>%
        </p>
    </div>
</div>

<div class="row">
    <div class="container center display-container col-md-offset-3 col-md-6">
        <h1 class="headings left row">Matches</h1>
        <%= form_tag player_path(@player), method: :get, id: :players_search, class: 'form-inline' do %>
            <%= hidden_field_tag :direction, params[:direction] %>
            <%= hidden_field_tag :sort, params[:sort] %>
            <p>
                <%= text_field_tag :search, params[:search], class: 'form-control' %>
                <%= submit_tag "Search", class: 'btn btn-danger' %>
            </p>
        <%end%>

        <% if @playermatch.count > 0 %>
            <% if @playermatch.count > @per_page %>
                <p><%= "#{@playermatch.count} found (displaying #{getRangeFromPage(params[:tournament_page], @playermatch.length)})" %></p>
            <% else %>
                <p><%= "#{@playermatch.count} found" %></p>
            <% end %>
        <% else %>
            <p>No matches found</p>
        <% end %>

        <div id="pagination">	
                <%= render partial: 'player_matches/match_links',
                collection: @matches,
                as: 'player_match' %>
            <%= will_paginate @matches, inner_window: 2, outer_window: 0 %>
        </div>
    </div>
</div>
